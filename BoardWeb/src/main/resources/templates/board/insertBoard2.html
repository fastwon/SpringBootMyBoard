<html xmlns:th="http://www.thymeleaf.org"
xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">

<head>
	<title>Fastwon Board</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<script type="text/javascript" src="/js/FastValidChecker.js"></script>
	<script type="text/javascript" src="/js/InsertBoardCheck.js"></script>
	<script type="text/javascript">
        /* function readURL(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('imagePreview').src = e.target.result;
                }
                reader.readAsDataURL(input.files[0]);
            }
        } */
        function readURL(input) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                var fileType = input.files[0].type; // 입력된 파일의 유형을 얻습니다.
                
                reader.onload = function(e) {
                    if (fileType.startsWith('image')) { // 이미지일 경우 img 태그로 미리보기
                        document.getElementById('imagePreview').src = e.target.result;
                    } else if (fileType.startsWith('video')) { // 동영상일 경우 video 태그로 미리보기
                        var source = document.createElement('source');

                        source.src = e.target.result;
                        source.type = fileType;

                        var previewVideo1= document.getElementById("videoPreview");
                        previewVideo1.innerHTML= "";
                        
                        previewVideo1.appendChild(source);
        				
        				previewVideo1.load(); 
                    }
                }

                reader.readAsDataURL(input.files[0]);
            } else {
            	if(document.getElementById('imagePreview') != null) {
	            	document.getElementById('imagePreview').src = "#";
            	}
            	
            	var previewVideo1= document.getElementById("videoPreview");
                previewVideo1.innerHTML= "";
                previewVideo1.load();
            	
            }
        }

    </script>
    <link rel="stylesheet" type="text/css" href="/css/entireDesign.css">
	<link rel="stylesheet" type="text/css" href="/css/modal.css">
</head>

<body th:align="center">

	<header>
		<div th:replace="/entire/head :: header"></div>
	</header>

<h1>게시글 등록</h1>
<form name="isbForm" th:action="@{/board/insertBoard}" method="post" enctype="multipart/form-data" onsubmit="return checkValid()">
	<input type="hidden" name="category" th:value="${category}" />
<table th:align="center" th:cellpadding="0" th:cellspacing="0">
	
	<tr>
		<td class="tagBox"th:text="제목" width="80"></td>
		<td><input name="title" type="text" size="50" placeholder="두 글자 이상" maxlength="50"></td>
	</tr>
	<tr>
		<td class="tagBox"th:text="작성자"></td>
		<td><span sec:authentication="principal.member.name"></span></td>
	</tr>
	<tr> <!-- 새로운 행을 추가해 파일을 선택할 수 있는 입력 요소를 만듭니다. -->
        <td class="tagBox"th:text="사진첨부"></td>
        <td><button id="openModal" type="button">사진</button></td>
    </tr>
    <tr> 
        <td class="tagBox">미리보기</td>
        <td><img th:if="${category.name()} != GAME" id='imagePreview2' src='#' alt='your image' /><video id="videoPreview2" controls></video></td> 
    </tr>
	<tr>
		<td class="tagBox" th:text="내용">
		<td><textarea name="content" cols="50" rows="10" maxlength="255"></textarea></td>
	</tr>
	<tr>
		<td colspan="2" align="center">
			<input class="btn" type="submit" value="게시글 등록">
		</td>
	</tr>
</table>

    <div id="myModal" class="modal">
	  <div class="modal-content">
	    <table th:align="center" th:cellpadding="0" th:cellspacing="0">
	
			<tr> <!-- 새로운 행을 추가해 파일을 선택할 수 있는 입력 요소를 만듭니다. -->
		        <td class="tagBox">사진첨부</td>
		        <td><input type="file" name="photo" onchange='readURL(this);'></td>
		    </tr>
		    <tr> 
		        <td class="tagBox">미리보기</td>
		        <td class="imgPre"><img th:if="${category.name()} != GAME" id='imagePreview' src='#' alt='your image' /><video id="videoPreview" controls></video></td> 
		    </tr>
		    <tr>
		    	<td colspan="2">
					<button id="closeModal" type="button">확인</button><button id="undoModal" type="button">취소</button>
		    	</td>
		    </tr>
		</table>
	  </div>
	</div>
</form>
<a th:href="@{/board/getBoardList(category=${category})}">글목록</a>

    <div th:replace="/entire/foot :: foot"></div>
    <script type="text/javascript" src="/js/modal.js"></script>
</body>
</html>